<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="utf-8">
<title>Inky</title>
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
	integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
	crossorigin="anonymous">
<link rel="stylesheet"
	href="https://use.fontawesome.com/releases/v5.12.1/css/all.css"
	integrity="sha384-v8BU367qNbs/aIZIxuivaU55N5GPF89WBerHoGA4QTcbUjYiLQtKdrfXnqAcXyTv"
	crossorigin="anonymous">
<link rel="stylesheet" href="/css/style.css">
<style>
.card{
height:700px;
}
.member_btn{
	margin-left:10px;
}
.input-group-prepend span{
	width:100px;
}
</style>
</head>
<body>
	<div class="container">
		<div class="d-flex justify-content-center h-100">
			<div class="card">
				<div class="card-header">
					<h3>회원정보</h3>
				</div>
				<div class="card-body">
					<form method="post" id="getmyForm" th:with="member=${#authentication.principal.member}">
						<div class="input-group form-group">
					<div class="input-group-prepend">
								<span class="input-group-text">아이디</span>
							</div> <input type="text" id="username" name="uid" class="form-control"
								th:value="${member.uid}" readonly="readonly">
						</div>
						<div class="input-group form-group" id="emailform">
							<div class="input-group-prepend">
								<span class="input-group-text">이메일</span>
							</div> <input type="text" id="uemail" name="uemail" class="form-control"
								th:value="${member.uemail}"  readonly="readonly">
						</div>
						<div class='profile-img form-group text-center'></div>
						<div class="input-group form-group">
							<div class="input-group-prepend">
								<span class="input-group-text">사용자이름</span>
							</div> <input type="text" id="uname" name="uname" class="form-control"
								th:value="${member.uname}"  readonly="readonly">
						</div>
						<input type="hidden" th:name="${_csrf.parameterName}"
							th:value="${_csrf.token}" />
						<div class="form-group">
							<input type="submit" value="정보수정" id="modify"
								class="btn float-right member_btn">
							<input type="submit" value="회원탈퇴" id="exit"
								class="btn float-right member_btn">
						</div>
					</form>
				</div>
				<div class="card-footer">
					<div class="d-flex justify-content-center">
						<a href="#">돌아가기</a>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="modal"><!-- Place at bottom of page --></div>
	<script src="https://code.jquery.com/jquery-3.1.1.min.js">
		<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
		integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
		crossorigin="anonymous">
	</script>
	<script
		src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
		integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
		crossorigin="anonymous"></script>
	<script
		src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
		integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
		crossorigin="anonymous"></script>
	<script src="https://kit.fontawesome.com/addd4c8dc0.js"
		crossorigin="anonymous"></script>
		<script th:inline="javascript">
			$body = $("body");

			$(document).on({
   				ajaxStart: function() { $body.addClass("loading");    },
     			ajaxStop: function() { $body.removeClass("loading"); }    
			});
		</script>
	<script th:inline="javascript">
		$(document).ready(function() {
			var csrf = JSON.parse('[[${_csrf}]]');
			$("#exit").on("click",function(e){
				e.preventDefault();
				if(confirm("정말로 회원탈퇴를 하시겠습니까?")){
					$.ajax({
						type:"delete",
						url:'/member/delete/'+$("input[name='uid']").val(),
						beforeSend:function(xhr){
							xhr.setRequestHeader(csrf.headerName,csrf.token);
						},
						success:function(result){
							alert("회원탈퇴에 성공했습니다!");
							location.href="/login";
						},
						error:function(error){
							alert("삭제하지못했습니다!");
							console.log(error);
						}
					});
				}
				
			});

		});
</script>
</body>

</html>