<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	layout:decorate="~{/layout/admin_main_layout}">
<head>
<meta charset="utf-8">
<style>
</style>
</head>
<section layout:fragment="content">
	<div class="card">
		<div class="card-header">
			<div>
				<h2 class="float-left">신고내역</h2>
			</div>
		</div>
		<div class="card-body">
			<ul class="list-group">
			</ul>
		</div>
		<div class="mx-auto">
			<ul class="pagination">
			</ul>
		</div>
	</div>
	<form id="gotoPage" method='post' action='/report/showPage'>
		<input type='hidden' name='title'>
		<input type='hidden' name='content'>
		<input type="hidden" th:name="${_csrf.parameterName}"
							th:value="${_csrf.token}" />
	</form>
</section>
<th:block layout:fragment="script">
	<script th:inline="javascript">
$(document).ready(function(){
	var formObj = $("#f1");
	var loc = window.location.href.toString().split(window.location.host)[1];
	loc = loc.substring(0,loc.indexOf("?"))+"?"+$('#f1').find('input[name!=dest]').serialize();
	console.log(loc);
	function getListWithPaging(sendData){
		console.log("getlistWithPaging");
		$.getJSON("/report/listPage",sendData,function(result){
			console.log(result);
			console.log(result.result.content);
			pageNum = result.currentPageNum;
			var content = result.result.content;
			var str = "";
			for(var i=0;i<content.length;i++){
				str += "<li class='list-group-item report-list'>";
				str += "	<a href='#' data-idx="+i+">";
				str += "		<span>신고번호:"+content[i].rno+"</span> ";
				if(content[i].target_kind == 'B'){
				str += "		<span>게시판신고내역입니다</span> ";
				}else{
				str += "		<span>댓글신고내역입니다</span> ";
				}
				str += "		<span>이유:"+content[i].reason+"</span> ";
				if(content[i].reporterId != null)
				str += "		<span>신고자:"+content[i].reporterId+"</span>";
				else
				str += "		<span>신고자:미상</span>";
				str += "	</a>";
				str += "</li>";
			}
			$(".list-group").html(str);
			$(".report-list a").on("click",function(e){
				e.preventDefault();
				var idx = $(this).data("idx");
				var formObj = $("#gotoPage");
				formObj.find("[name='title']").val(content[idx].title);
				formObj.find("[name='content']").val(content[idx].content);
				formObj.submit();
			});
		});
	}
	var pageNum = 1;
	var sendData = {
			page:pageNum
	};
	getListWithPaging(sendData);//초기 페이지 불러오기
	
});
</script>
</th:block>
</html>